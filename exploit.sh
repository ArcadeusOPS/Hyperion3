#!/bin/bash
# Script for Hyperion v3.x for exploit searching using searchsploit and nmap
# Usage ./exploit.sh 8.8.8.8 Linux 2.6 mydir - as single command line argument but can use website instead of IP address eg google.com for 8.8.8.8.
# First argument $1: $usIP user IP
# second argumnet OS Version
# third argument $3 mydir
# User Input from  command line arguments
userIP="$1" # IP address eg 8.8.8.8
useros="$2" # OS version eg Ubuntu 20.0.04 ot Windows Server 2016 R2
udir="$3" # directory for reports

# checks all results in Nmap's XML output with service version
sudo nmap -vv $userIP --script exploit -p - -oX mal.xml
xsltproc mal.xml -o expmal1.html

# searchsplpoit using nmap output above
searchsploit --nmap mal.xml -w  > nexp.txt
cat nexp.txt | grep CVE > exploitnmap.txt
sed -i '1i Exploitdb Search From NMap Scan\n---------------------------------------' exploitnmap.txt

# searchsploit using OS supplied by user
searchsploit $useros -w > exp.txt
#cat exp.txt | grep CVE > exdb.txt
sed -i '1i Exploitdb Search for Known Exploit Code with user supplied OS\n--------------------------------------------------------------' exp.txt

# local storage ready for upload to client's container
cd /
cd root
mkdir $udir
cd $udir
mv /root/exp.txt /root/$udir/exp.txt
mv /root/expmal1.html /root/$udir/expmal1.html
mv /root/exploitnmap.txt /root/$udir/exploitnmap.txt
echo " Your results are stored in directory $udir "
sleep 10
cd /
cd root
